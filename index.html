<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Key System Management</title>
    <link rel="stylesheet" href="styles.css">
        <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;700&display=swap">
</head>
<body>
    <div class="container">
        <h1><i class="fas fa-key"></i> Key System Management</h1>
        <div class="tabs">
            <div class="tab <?php echo $current_tab === 'generate_key' ? 'active' : ''; ?>" data-tab="generate_key">Generate Key</div>
            <div class="tab <?php echo $current_tab === 'manage_key' ? 'active' : ''; ?>" data-tab="manage_key">Edit Key</div>
            <div class="tab <?php echo $current_tab === 'ban_devices' ? 'active' : ''; ?>" data-tab="ban_devices">Ban ID Device</div>
        </div>
        <div class="tab-content <?php echo $current_tab === 'generate_key' ? 'active' : ''; ?>" id="generate_key">
    <h2><i class="fas fa-circle-plus" style="color: #28a745;"></i> Generate Key</h2><br>
            <?php if ($generate_key_message): ?>
    <div class="notification <?php echo strpos($generate_key_message, 'Error') === false ? 'success' : 'error'; ?>">
        <div class="icon"></div>
        <p><?php echo htmlspecialchars($generate_key_message); ?></p>
    </div>
<?php endif; ?>

<?php if ($upload_message): ?>
    <div class="notification <?php echo strpos($upload_message, 'Error') === false ? 'success' : 'error'; ?>">
        <div class="icon"></div>
        <p><?php echo htmlspecialchars($upload_message); ?></p>
    </div>
<?php endif; ?>

<?php if ($failed_message): ?>
    <div class="notification <?php echo strpos($upload_message, 'Error') === true ? 'success' : 'error'; ?>">
        <div class="icon"></div>
        <p><?php echo htmlspecialchars($failed_message); ?></p>
    </div>
<?php endif; ?>

            <form method="post">
                <input type="text" name="key_name" placeholder="Key Name" required>
                <input type="date" name="expiration_date" required>
                <input type="number" name="usage_limit" placeholder="Usage Limit" required>
<button type="submit" name="generate_key">Create</button>
            </form>
        </div>
        <div class="tab-content <?php echo $current_tab === 'manage_key' ? 'active' : ''; ?>" id="manage_key">
    <h2><i class="fas fa-pen" style="color: #17a2b8;"></i> Edit Key</h2><br>
            <?php if ($manage_key_message): ?>
                <div class="notification <?php echo strpos($manage_key_message, 'Error') === false ? 'success' : 'error'; ?>">
                    <div class="icon"></div>
                    <p><?php echo htmlspecialchars($manage_key_message); ?></p>
                </div>
            <?php endif; ?>
            <?php if ($failed_message): ?>
    <div class="notification <?php echo strpos($upload_message, 'Error') === true ? 'success' : 'error'; ?>">
        <div class="icon"></div>
        <p><?php echo htmlspecialchars($failed_message); ?></p>
    </div>
<?php endif; ?>
            <form method="post">
                    <h3><i class="fas fa-trash-can"></i> Delete Key</h3>
                <select name="key_id" required>
                    <option value="">Select Key</option>
                    <?php echo $key_options; ?>
                </select>
<button type="submit" name="delete_key">Delete Key</button>
            </form>
            <form method="post">
                    <h3><i class="fas fa-clock"></i> Update Expiration Date</h3>
                <select name="key_id" required>
                    <option value="">Select Key</option>
                    <?php echo $key_options; ?>
                </select>
                <input type="date" name="new_expiration_date" required>
                <button type="submit" name="update_expiration">Update Expiration Date</button><br>
            </form>
            <form method="post">
                    <h3><i class="fas fa-users"></i></i> Set Usage Limit</h3>
                <select name="key_id" required>
                    <option value="">Select Key</option>
                    <?php echo $key_options; ?>
                </select>
                <input type="number" name="new_usage_limit" placeholder="New Usage Limit" required>
                <button type="submit" name="set_usage_limit">Set Usage Limit</button><br>
            </form>
<form method="post">
                    <h3><i class="fas fa-user-minus"></i> Reset Current Usage</h3>
    <select name="key_id" required>
        <option value="">Select Key</option>
        <?php echo $key_options; ?>
    </select>
    <button type="submit" name="reset_user_count_specific">Reset</button><br>
</form>
        </div>
        <div class="tab-content <?php echo $current_tab === 'ban_devices' ? 'active' : ''; ?>" id="ban_devices">
    <h2><i class="fas fa-ban" style="color: #dc3545;"></i> Ban Devices</h2><br>
    <?php if ($ban_devices_message): ?>
        <div class="notification <?php echo strpos($ban_devices_message, 'Error') === false ? 'success' : 'error'; ?>">
            <div class="icon"></div>
            <p><?php echo htmlspecialchars($ban_devices_message); ?></p>
        </div>
    <?php endif; ?>
    <?php if ($failed_message): ?>
    <div class="notification <?php echo strpos($upload_message, 'Error') === true ? 'success' : 'error'; ?>">
        <div class="icon"></div>
        <p><?php echo htmlspecialchars($failed_message); ?></p>
    </div>
<?php endif; ?>
    <form method="post">
                    <h3><i class="fas fa-user-pen"></i> Banned User</h3>
        <select name="device_id" required>
            <option value="">Select Device</option>
            <?php echo $select_device_options; ?>
        </select>
        <input type="text" name="ban_reason" placeholder="Reason for Ban" required>
        <button type="submit" name="ban_action">Ban Device</button>
    </form>
    <form method="post">
                    <h3><i class="fas fa-user-slash"></i> UnBanned User</h3>
        <select name="device_id" required>
            <option value="">Select Device</option>
            <?php echo $banned_device_options; ?>
        </select>
        <button type="submit" name="unban_action">Unban Device</button>
    </form>
</div>

          <button class="delete-all" onclick="confirmDelete()">Delete All Data</button>
    </div>
    <form action="" method="post" enctype="multipart/form-data" id="upload-form">
        <input type="file" id="file-input" name="file" accept=".lua" onchange="submitForm()" required>
        <button type="button" class="upload-all" onclick="document.getElementById('file-input').click();">Upload Script
        </button>
    </form>
    </div>
    <div class="footer">
        <p>© Powered By Alex</p>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            document.body.classList.add('loaded');

            const tabs = document.querySelectorAll('.tab');
            const tabContents = document.querySelectorAll('.tab-content');

            // Lưu trữ tab đang hoạt động
            const activeTab = localStorage.getItem('activeTab') || tabs[0].getAttribute('data-tab');
            
            function showTab(tabId) {
                tabs.forEach(tab => tab.classList.remove('active'));
                tabContents.forEach(content => {
                    if (content.id === tabId) {
                        content.classList.add('active');
                    } else {
                        content.classList.remove('active');
                    }
                });

                const activeTabElement = document.querySelector(`.tab[data-tab="${tabId}"]`);
                if (activeTabElement) {
                    activeTabElement.classList.add('active');
                }
            }

            showTab(activeTab);

            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabId = tab.getAttribute('data-tab');
                    showTab(tabId);
                    localStorage.setItem('activeTab', tabId); // Lưu tab hiện tại vào localStorage
                });
            });
        });
        
        document.addEventListener('DOMContentLoaded', function() {
        // Function to hide notifications
        function hideNotifications() {
            const notifications = document.querySelectorAll('.notification');
            notifications.forEach(notification => {
                notification.style.display = 'none';
            });
        }

        // Add event listener to tabs
        const tabs = document.querySelectorAll('.tab');
        tabs.forEach(tab => {
            tab.addEventListener('click', function() {
                // Hide notifications when switching tabs
                hideNotifications();
            });
        });
    });
        
    document.querySelectorAll('button').forEach(button => {
        button.addEventListener('mousedown', () => {
            button.classList.add('clicked');
            setTimeout(() => button.classList.remove('clicked'), 500); // Thời gian hiệu ứng
        });
    });

        function confirmDelete() {
            if (confirm('Are you sure you want to delete all data? This action cannot be undone.')) {
                window.location.href = 'Reset_AllData';
            }
        }
    function submitForm() {
            document.getElementById('upload-form').submit();
        }
    </script>
</body>
</html>